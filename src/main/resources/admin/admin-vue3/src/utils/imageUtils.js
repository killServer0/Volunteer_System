// 通用图片工具函数

// Base64编码的空白图像，用作本地占位符
const localPlaceholderImage = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAACXBIWXMAAAsTAAALEwEAmpwYAAAF7mlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDUgNzkuMTYzNDk5LCAyMDE4LzA4LzEzLTE2OjQwOjIyICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgKFdpbmRvd3MpIiB4bXA6Q3JlYXRlRGF0ZT0iMjAyMy0wNi0xOVQxNDoxMzo0OCswODowMCIgeG1wOk1vZGlmeURhdGU9IjIwMjMtMDYtMTlUMTQ6MTc6NDErMDg6MDAiIHhtcDpNZXRhZGF0YURhdGU9IjIwMjMtMDYtMTlUMTQ6MTc6NDErMDg6MDAiIGRjOmZvcm1hdD0iaW1hZ2UvcG5nIiBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIiBwaG90b3Nob3A6SUNDUHJvZmlsZT0ic1JHQiBJRUM2MTk2Ni0yLjEiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6NjA4ZGNiMzYtMzZhMC0xZDRk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';

/**
 * 获取图片URL，提供本地和远程占位图备选方案
 * @param {string} photoPath - 图片路径
 * @param {boolean} useLocalPlaceholder - 是否使用本地占位图 (默认为true)
 * @returns {string} - 图片URL
 */
export function getImageUrl(photoPath, useLocalPlaceholder = true) {
  if (!photoPath || photoPath === 'undefined') {
    // 使用本地Base64占位图，避免网络请求
    return useLocalPlaceholder 
      ? localPlaceholderImage 
      : 'https://via.placeholder.com/100x100?text=No+Image';
  }
  
  if (photoPath.startsWith('http')) {
    return photoPath;
  }
  
  // 从upload/路径中提取文件名
  const fileName = photoPath.startsWith('upload/') ? photoPath.substring(7) : photoPath;
  
  return `http://localhost:8081/zhiyuanzheguanlixitong/file/download?fileName=${fileName}`;
}

/**
 * 处理图片加载错误，使用本地占位图作为备选
 * @param {Event} e - 错误事件
 */
export function handleImageError(e) {
  console.log('图片加载失败，使用本地占位图');
  e.target.src = localPlaceholderImage;
}

// 导出默认占位图，方便在组件中直接使用
export const placeholderImage = localPlaceholderImage; 